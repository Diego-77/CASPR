classdef WorkspaceTaskWrenchClosure < WorkspaceCondition
    %IDFUNCTION Summary of this class goes here
    %   Detailed explanation goes here
    % THIS IS A WORK IN PROGRESS!!!!!!!!!
    properties (SetAccess = protected, GetAccess = protected)
    end
    
    methods
        function id = WorkspaceTaskWrenchClosure()
        end
        
        function [inWorkspace] = evaluate(obj,dynamics)
	    % This function will not be complete until the necessary output jacobian is added
            JL      =   -pinv(dynamics.J')*dynamics.L';
            JL_rank  =   rank(JL);
            H       =   eye(dynamics.numCables);
            f       =   zeros(dynamics.numCables,1);
            A       =   [];
            b       =   [];
            Aeq     =   JL;
            beq     =   zeros(dynamics.numOutDofs,1);
            lb      =   1e-6*ones(dynamics.numCables,1);
            ub      =   Inf*ones(dynamics.numCables,1);
            options =   optimset('display','off');
            [~,~,exit_flag] = quadprog(H,f,A,b,Aeq,beq,lb,ub,[],options);
            inWorkspace = (exit_flag==1) && (L_rank == dynamics.numOutDofs);
        end
        
        function [isConnected] = connected(obj,workspace,i,j,grid)
            % This file may need a dynamics object added at a later date
            tol = 1e-6;
	    L_rank = dynamics.rank(L);
            isConnected = sum((abs(workspace(:,i) - workspace(:,j)) < grid.delta_q+tol)) + sum((abs(workspace(:,i) - workspace(:,j)-2*pi) < grid.delta_q+tol)) + sum((abs(workspace(:,i) - workspace(:,j)+2*pi) < grid.delta_q+tol)) == grid.n_dimensions;
        end
    end
end

